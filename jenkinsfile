pipeline{
    agent any
    environment {
      PATH="/opt/maven/bin:$PATH"
    }
    stages {
        stage("Git-checked"){
            steps {
              git credentialsId: 'a3006431-8358-4c71-ba3c-f311b3ff18a9', url: 'https://github.com/lanru2001/my-intro-website.git'
           
            }  
        }

        stage("Maven Build") {
            steps { 
                sh  "mvn clean package"
                sh  "mv target/*.war  target/myweb.war" 

            } 
        }
     
        stage("deploy-dev") {
            steps {
                
                sshagent(['tomcat-keys']) {
                   sh """
                    scp -o StrictHostKeyChecking=no  target/myweb.war  ec2-user@3.135.28.9:/opt/tomcat/webapps/
                    
                    ssh ec2-user@3.135.28.9   /opt/tomcat/bin/shutdown.sh
                    
                    ssh ec2-user@3.135.28.9   /opt/tomcat/bin/startup.sh 
                   
                   """                  
                }
            }  
        } 
    }  
